# 政府采购信息提取工具

**作者**: 赵miss  
**单位**: 中国社会科学院大学

---

一个用于批量提取政府采购HTML公告中关键信息的Python工具,支持导出为CSV、JSONL和XLSX格式。

## 功能特点

- 📄 **批量处理**: 自动遍历目录中的所有HTML文件
- 🎯 **精准提取**: 提取9个关键采购指标
- 📊 **多格式导出**: 支持CSV、JSONL、XLSX三种格式
- 🔍 **智能识别**: 自动处理各种HTML表格结构,包括rowspan/colspan
- 📅 **日期格式化**: 统一日期格式为 `YYYY年MM月DD日`,保留前导0
- 💰 **金额标准化**: 自动识别和格式化中标金额
- 📝 **文本清理**: 自动清理冗余空白字符和通用模板文本

## 提取字段

| 字段名称 | 说明 | 示例 |
|---------|------|------|
| 公告时间 | 公告发布日期 | 2021年05月24日 |
| 项目名称 | 采购项目完整名称 | (佛山市南海区妇幼保健院)(南海区妇幼保健院保安服务) 的成交结果公告 |
| 采购单位名称 | 采购方单位名称 | 佛山市南海区妇幼保健院 |
| 采购单位地址 | 采购方单位地址 | 广东省佛山市南海区桂城桂平西路6号 |
| 供应商名称 | 中标供应商名称 | 广州市庆德保安服务有限公司 |
| 供应商地址 | 中标供应商地址 | 广州市白云区恒骏街4号405房自编1号 |
| 中标金额 | 中标金额(元) | 1395072.00 |
| 采购类别 | 采购类型 | 服务/货物/工程 |
| 采购标的 | 采购目标内容 | 南海区妇幼保健院保安服务 |

## 安装依赖

```bash
pip install beautifulsoup4 lxml python-dateutil openpyxl
```

或使用conda:

```bash
conda install beautifulsoup4 lxml python-dateutil openpyxl
```

## 使用方法

### 基本用法

```bash
python extract_html_procurement.py
```

默认从 `./data` 目录读取HTML文件,结果输出到 `./result` 目录。

### 自定义输入输出路径

```bash
python extract_html_procurement.py --input /path/to/html/files --output /path/to/results
```

### 启用详细日志

```bash
python extract_html_procurement.py --verbose
```

## 目录结构

```
政府采购信息提取/
├── extract_html_procurement.py  # 主程序
├── README.md                     # 说明文档
├── data/                         # HTML文件目录(默认)
│   ├── 公告1/
│   │   └── 公告1.html
│   ├── 公告2/
│   │   └── 公告2.html
│   └── ...
└── result/                       # 输出结果目录
    ├── extracted.csv             # CSV格式
    ├── extracted.jsonl           # JSONL格式
    └── extracted.xlsx            # Excel格式(推荐)
```

## 输出格式说明

### 1. CSV格式 (`extracted.csv`)

- 编码: UTF-8 with BOM
- 分隔符: 逗号
- "公告时间"字段使用Excel公式格式保留前导0

### 2. JSONL格式 (`extracted.jsonl`)

- 每行一个JSON对象,方便程序处理
- 适合大数据集的流式处理

```json
{"公告时间": "2021年05月24日", "项目名称": "...", ...}
{"公告时间": "2021年08月17日", "项目名称": "...", ...}
```

### 3. XLSX格式 (`extracted.xlsx`) ⭐ 推荐

- Excel原生格式,完美支持
- "公告时间"列设置为文本格式,自动保留前导0
- 表头加粗,自动调整列宽
- 无需任何特殊处理,直接打开即用

## 技术特点

### 智能表格解析

- ✅ 支持复杂HTML表格结构
- ✅ 正确处理 `rowspan` 和 `colspan` 属性
- ✅ 自动识别表头映射关系
- ✅ 智能过滤通用模板文本

### 日期格式统一

- 自动识别多种日期格式
- 统一输出为 `YYYY年MM月DD日`
- 单数月份和日期自动补0 (如 `05月` 而非 `5月`)

### 金额标准化

- 自动识别中文大写金额
- 支持千分位格式 (如 `1,234,567.89`)
- 统一转换为数字格式 (保留两位小数)

### 地址智能匹配

- 根据采购单位/供应商名称智能匹配对应地址
- 避免混淆采购单位和代理机构地址
- 基于地理位置关键词提升匹配准确度

## 示例

### 输入HTML片段

```html
<p>公告时间:2021年5月24日</p>
<p>采购人名称:佛山市南海区妇幼保健院</p>
<table>
  <tr>
    <td>中标供应商</td>
    <td>广州市庆德保安服务有限公司</td>
  </tr>
  <tr>
    <td>中标金额</td>
    <td>壹佰叁拾玖万伍仟零柒拾贰元整</td>
  </tr>
</table>
```

### 输出结果

| 公告时间 | 采购单位名称 | 供应商名称 | 中标金额 |
|---------|-------------|-----------|---------|
| 2021年05月24日 | 佛山市南海区妇幼保健院 | 广州市庆德保安服务有限公司 | 1395072.00 |

## 常见问题

### Q: Excel打开CSV后日期前导0消失?

**A**: 请使用 **XLSX格式** (`extracted.xlsx`),这是最完美的解决方案!XLSX文件中"公告时间"列已设置为文本格式,Excel会正确显示 `2021年05月24日`。

### Q: 某些字段提取不准确?

**A**: 启用详细日志查看提取过程:
```bash
python extract_html_procurement.py --verbose
```

### Q: 如何处理大量文件?

**A**: 工具已优化性能,支持批量处理。对于超大数据集,建议:
1. 分批处理
2. 使用JSONL格式(流式处理)
3. 检查日志中的错误信息

## 依赖库版本

- Python 3.7+
- beautifulsoup4 >= 4.9.0
- lxml >= 4.6.0
- python-dateutil >= 2.8.0
- openpyxl >= 3.0.0

## 更新日志

### v1.0 (2025-10-19)

- ✨ 初始版本发布
- ✨ 支持9个字段提取
- ✨ 支持CSV、JSONL、XLSX三种格式
- ✨ 智能处理rowspan/colspan表格
- ✨ 日期格式统一化(补0)
- ✨ 采购标的字段智能过滤规格型号
- ✨ XLSX格式完美支持文本日期

## 许可证

MIT License

## 贡献

欢迎提交Issue和Pull Request!

## 联系方式

如有问题或建议,请通过GitHub Issues联系。
